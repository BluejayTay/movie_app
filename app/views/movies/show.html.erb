<div class="container my-5">
  <div class="row g-0">
    <div class="card mb-3 border-dark shadow-lg mx-auto" style="max-width:900px">
      <div class="row g-0">
        <div class="col-md-6 bg-dark">
          <img class="img-fluid rounded-top " src="https://image.tmdb.org/t/p/original<%= @movie['poster_path']%>" alt="Poster image">
          <div class="card-footer text-end flush" style="background-color:black;"> 
            <% m = current_user.movies.find_by(api_id: @movie["id"])%>
            <% if m.present? %>
              <% wlm = current_user.watch_list_movies.find_by(movie_id: m.id)%>
              <%= link_to "- Watchlist", watch_list_movie_path(wlm.id), method: :delete, data: {confirm: "Are you sure?"}, class: "btn btn-sm btn-outline-danger"%>
            <% else %>
              <%= form_with(model: current_user.watch_list_movies.build) do |f| %>
                <%= f.hidden_field :api_id, :value => @movie["id"] %>
                <%= f.hidden_field :image_url, :value => @movie["poster_path"] %>
                <%= f.hidden_field :name, :value => @movie["title"] %> 
                <%= f.submit "+ Watchlist", class: "btn btn-outline-primary btn-sm" %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="col-md-6 bg-white rounded">
          <div class="card-header">
            <h1 class="text-center m-0 p-2 "><%=@movie["title"] %></h1>
            <h5 class="text-center m-0 pb-2 "><%=@movie["tagline"] %> </h5>
          </div>
          <div class="card-body rounded-end p-0">
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><strong>Rating:</strong> <%=@movie["vote_average"] %>/10 (<%=@movie["vote_count"] %> votes)</li>
              <li class="list-group-item"><strong>Runtime:</strong> <%=@movie["runtime"]%> minutes</li>
              <li class="list-group-item"><strong>Status:</strong> <%=@movie["status"] %></li>
              <li class="list-group-item d-flex justify-content-between"><div><strong>Release date:</strong> <%=@movie["release_date"][5..6]%>/<%=@movie["release_date"][8..9]%>/<%=@movie["release_date"][0..3]%></div>
              <% if @movie["homepage"].present? %>
                  <a href='<%=@movie["homepage"] %>'>Website</a>
                <% end %></li>
              <li class="list-group-item rounded-bottom"><strong>Overview:</strong> <%=@movie["overview"] %><br>
                
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-0">
    <div class="card mx-auto bg-light border-dark rounded-bottom " style="max-width:900px">
      <div class="card-header p-0 text-center">
        <h3 class="p-3 m-0">Reviews for <%=@movie["title"]%></h3>
      </div>
      <div class="row g-0 ">
        <div class="col-md-6 rounded-bottom m-0">
            <% m = Movie.find_by(api_id: @movie["id"])%>
            <% if m.present? %>
              <% if m.reviews.present? %>
              <ul class="list-group list-group-flush">
                <% m.reviews.each do |review|%>
                <li class="list-group-item bg-light">
                  <h6 class=""><%= review.user.username%> on <%= review.created_at.month%>-<%= review.created_at.day%>-<%= review.created_at.year%>:</h6>
                  <span class=""><%= review.rating%>/10: <%= review.content%></span>
                </li>
                <% end %>
              </ul>
              <% else%>
                <p>No reviews yet</p>
              <% end %>
            <% else%>
              <p>No reviews yet</p>
            <% end %>
            
            
          
        </div>
        <div class="col-md-6 bg-light rounded-bottom">
            <h4 class="p-3 m-0">Write a Review</h4>
            <div class="px-3 pt-0 m-0">
              <%= simple_form_for Review.new do |f| %>
                <%= f.hidden_field :api_id, value: @movie["id"] %>
                <%= f.hidden_field :image_url, value: @movie["poster_path"] %>
                <%= f.hidden_field :name, value: @movie["title"] %> 
                <%= f.input :rating, collection: 0..10 %>
                <%= f.input :content %>
                <%= f.button :submit, "Submit", class: "btn btn-primary my-3"%> 
              <% end %>
            </div>
        </div>
      </div>
      
      
    </div>
  </div>
</div>
